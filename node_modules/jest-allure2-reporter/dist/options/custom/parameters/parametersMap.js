"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parametersMap = parametersMap;
const utils_1 = require("../../../utils");
const simplifyParametersMap_1 = require("./simplifyParametersMap");
function parametersMap(customizer) {
    const simplifiedCustomizer = (0, simplifyParametersMap_1.simplifyParametersMap)(customizer);
    const customizerKeys = Object.keys(simplifiedCustomizer);
    return async (context) => {
        return (0, utils_1.thruMaybePromise)(context.value, (value) => {
            const parameters = (0, utils_1.groupBy)(value, 'name');
            const keys = (0, utils_1.uniq)([...customizerKeys, ...Object.keys(parameters)]);
            const batches = keys.map((key) => {
                const keyedContext = { ...context, value: (0, utils_1.last)(parameters[key]) };
                const keyedCustomizer = simplifiedCustomizer[key];
                return keyedCustomizer ? keyedCustomizer(keyedContext) : keyedContext.value;
            });
            return (0, utils_1.maybePromiseAll)(batches, (batch) => (0, utils_1.compactArray)(batch));
        });
    };
}
//# sourceMappingURL=parametersMap.js.map